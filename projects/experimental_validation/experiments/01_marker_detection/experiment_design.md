# 实验设计：标记点检测算法验证

## 实验基本信息
- **实验编号**: EXP-001
- **实验名称**: 视触传感器标记点检测算法验证
- **实验日期**: 2026-02-24
- **实验人员**: 技术验证团队
- **相关项目**: 视触传感器技术开发
- **版本**: 1.0

## 1. 实验目的
验证视触传感器标记点检测算法的准确性和鲁棒性，为后续位移场计算和力估计提供可靠的基础。

## 2. 背景与原理
视触传感器通过在弹性体表面布置标记点阵列，通过视觉跟踪标记点位移来测量接触力。标记点检测是传感器信号处理的第一步，检测精度直接影响最终力测量精度。

**检测原理**：
1. **圆形标记点检测**：使用Hough圆变换或圆拟合方法
2. **特征点检测**：使用Harris、FAST、ORB等特征检测算法
3. **深度学习检测**：使用卷积神经网络进行端到端检测

## 3. 实验假设
1. Hough圆变换在理想圆形标记点上检测精度 > 95%
2. 标记点间距对检测精度有显著影响
3. 图像噪声会降低检测算法的召回率

## 4. 实验变量
### 独立变量
- **标记点形状**：圆形、方形、自定义图案（3水平）
- **标记点间距**：10px, 20px, 30px, 40px（4水平）
- **图像噪声水平**：高斯噪声σ=0, 5, 10, 20（4水平）
- **光照不均匀度**：对比度变化0%, 20%, 40%（3水平）

### 依赖变量
- **检测精度**：准确率、召回率、F1分数（%）
- **检测速度**：处理单帧时间（ms）
- **定位误差**：检测位置与真实位置的平均欧氏距离（px）

### 控制变量
- **图像分辨率**：固定为640×480像素
- **标记点大小**：固定半径6像素
- **算法参数**：同一算法使用相同参数设置
- **运行环境**：相同硬件和软件环境

## 5. 实验设备与材料
### 硬件设备
| 设备名称 | 型号/规格 | 数量 | 用途 |
|---------|----------|------|------|
| 合成数据生成器 | Python脚本 | 1 | 生成测试图像 |
| 计算服务器 | CPU: Intel i7, RAM: 32GB | 1 | 算法运行 |

### 软件工具
| 工具名称 | 版本 | 用途 |
|---------|------|------|
| Python | 3.11+ | 主要编程语言 |
| OpenCV | 4.8+ | 图像处理库 |
| NumPy | 1.24+ | 数值计算 |
| Matplotlib | 3.7+ | 结果可视化 |
| 自定义算法库 | vbts_algorithms | 标记点检测算法 |

## 6. 实验步骤
### 6.1 准备工作
1. 安装和配置Python环境及依赖库
2. 克隆vbts_algorithms项目到实验目录
3. 创建实验数据目录结构

### 6.2 合成数据生成
1. 使用`MarkerDetection.generate_synthetic_markers()`生成基准标记点网格
2. 生成不同条件下的测试图像：
   - 不同标记点形状
   - 不同间距配置
   - 添加不同水平的噪声
   - 模拟不同光照条件
3. 保存生成图像和真实标记点坐标（ground truth）

### 6.3 算法测试
1. 对每组测试图像运行以下检测算法：
   - Hough圆变换（OpenCV实现）
   - 圆拟合（RANSAC方法）
   - Harris角点检测
   - FAST特征检测
   - ORB特征检测
2. 记录每个算法的检测结果和运行时间

### 6.4 性能评估
1. 计算每个算法的性能指标：
   - 准确率 = TP / (TP + FP)
   - 召回率 = TP / (TP + FN)  
   - F1分数 = 2 × (准确率 × 召回率) / (准确率 + 召回率)
   - 平均定位误差
   - 平均处理时间
2. 统计不同条件下的性能变化

### 6.5 数据记录
1. 将原始结果保存为CSV格式
2. 生成可视化图表
3. 撰写实验结果总结

## 7. 数据记录格式
### 原始数据
- 图像文件：`标记点形状_间距_噪声水平_光照_序号.png`
- Ground truth文件：`标记点形状_间距_噪声水平_光照_序号_gt.csv`
- 元数据：`实验参数.json`

### 处理后的数据
- 检测结果：`算法名_参数_结果.csv`
- 性能指标：`性能汇总.csv`
- 可视化图表：`性能对比图.png`, `误差分布图.png`

## 8. 数据分析方法
### 8.1 数据处理流程
```python
# 伪代码
1. 加载ground truth和检测结果
2. 匹配检测到的标记点和真实标记点（最近邻匹配）
3. 计算TP, FP, FN
4. 计算性能指标
5. 统计定位误差
```

### 8.2 统计分析
- **方差分析（ANOVA）**：分析不同因素对检测精度的影响显著性
- **相关性分析**：分析各变量间的相关性
- **趋势分析**：分析性能随变量变化的趋势

### 8.3 可视化
- **柱状图**：不同算法的性能对比
- **箱线图**：定位误差分布
- **热力图**：不同条件下的性能变化
- **散点图**：检测时间与精度的关系

## 9. 预期结果
1. Hough圆变换在理想圆形标记点上表现最佳
2. 标记点间距越小，检测难度越大（容易混淆）
3. 噪声对基于梯度的算法影响较大
4. FAST算法速度最快但精度较低
5. ORB算法在旋转变化下表现稳定

## 10. 潜在问题与解决方案
| 潜在问题 | 可能原因 | 解决方案 |
|---------|----------|----------|
| 标记点匹配错误 | 检测点与真实点对应关系混乱 | 使用匈牙利算法进行最优匹配 |
| 算法参数敏感 | 参数设置不当导致性能下降 | 进行参数网格搜索优化 |
| 内存不足 | 大规模测试数据占用内存大 | 分批处理，使用内存映射文件 |
| 结果不可复现 | 随机数种子未固定 | 固定所有随机数种子 |

## 11. 安全注意事项
1. 本实验为纯软件仿真，无物理安全风险
2. 注意数据备份，防止结果丢失
3. 遵守软件许可协议

## 12. 参考文献
1. OpenCV官方文档：Hough Circle Transform
2. Rosten, E., & Drummond, T. (2006). Machine learning for high-speed corner detection
3. Rublee, E., et al. (2011). ORB: An efficient alternative to SIFT or SURF
4. 视触传感器算法文档：`../data/视触技术要点/concepts/视触传感器算法与处理.md`

## 附录
### 附录A: 计算公式
- **准确率**: $Precision = \frac{TP}{TP+FP}$
- **召回率**: $Recall = \frac{TP}{TP+FN}$
- **F1分数**: $F1 = 2 \times \frac{Precision \times Recall}{Precision + Recall}$
- **定位误差**: $Error = \sqrt{(x_{det}-x_{gt})^2 + (y_{det}-y_{gt})^2}$

### 附录B: 代码片段
```python
# 检测精度评估函数
def evaluate_detection(ground_truth, detected_points, threshold=5.0):
    """
    评估标记点检测精度
    
    参数:
        ground_truth: 真实标记点坐标 (N, 2)
        detected_points: 检测到的标记点坐标 (M, 2)
        threshold: 匹配阈值（像素）
    
    返回:
        precision, recall, f1, avg_error
    """
    # 实现匹配和指标计算
    pass
```

### 附录C: 数据记录表模板
| 图像ID | 算法 | TP | FP | FN | 准确率 | 召回率 | F1 | 平均误差 | 处理时间 |
|--------|------|-----|-----|-----|--------|--------|----|----------|----------|

---

**实验设计批准**:  
- 设计者: _________________ 日期: ________  
- 审核者: _________________ 日期: ________  
- 批准者: _________________ 日期: ________